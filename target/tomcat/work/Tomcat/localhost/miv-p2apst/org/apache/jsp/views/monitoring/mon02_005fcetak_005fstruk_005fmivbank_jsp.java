/*
 * Generated by the Jasper component of Apache Tomcat
 * Version: Apache Tomcat/7.0.47
 * Generated at: 2025-12-04 08:24:16 UTC
 * Note: The last modified time of this file was set to
 *       the last modified time of the source file after
 *       generation to assist with modification tracking.
 */
package org.apache.jsp.views.monitoring;

import javax.servlet.*;
import javax.servlet.http.*;
import javax.servlet.jsp.*;

public final class mon02_005fcetak_005fstruk_005fmivbank_jsp extends org.apache.jasper.runtime.HttpJspBase
    implements org.apache.jasper.runtime.JspSourceDependent {

  private static final javax.servlet.jsp.JspFactory _jspxFactory =
          javax.servlet.jsp.JspFactory.getDefaultFactory();

  private static java.util.Map<java.lang.String,java.lang.Long> _jspx_dependants;

  private javax.el.ExpressionFactory _el_expressionfactory;
  private org.apache.tomcat.InstanceManager _jsp_instancemanager;

  public java.util.Map<java.lang.String,java.lang.Long> getDependants() {
    return _jspx_dependants;
  }

  public void _jspInit() {
    _el_expressionfactory = _jspxFactory.getJspApplicationContext(getServletConfig().getServletContext()).getExpressionFactory();
    _jsp_instancemanager = org.apache.jasper.runtime.InstanceManagerFactory.getInstanceManager(getServletConfig());
  }

  public void _jspDestroy() {
  }

  public void _jspService(final javax.servlet.http.HttpServletRequest request, final javax.servlet.http.HttpServletResponse response)
        throws java.io.IOException, javax.servlet.ServletException {

    final javax.servlet.jsp.PageContext pageContext;
    javax.servlet.http.HttpSession session = null;
    final javax.servlet.ServletContext application;
    final javax.servlet.ServletConfig config;
    javax.servlet.jsp.JspWriter out = null;
    final java.lang.Object page = this;
    javax.servlet.jsp.JspWriter _jspx_out = null;
    javax.servlet.jsp.PageContext _jspx_page_context = null;


    try {
      response.setContentType("text/html;charset=UTF-8");
      pageContext = _jspxFactory.getPageContext(this, request, response,
      			null, true, 8192, true);
      _jspx_page_context = pageContext;
      application = pageContext.getServletContext();
      config = pageContext.getServletConfig();
      session = pageContext.getSession();
      out = pageContext.getOut();
      _jspx_out = out;

      out.write("\r\n");
      out.write("\r\n");
      out.write("<style>\r\n");
      out.write("/* ----------\r\n");
      out.write("   Spinner CSS (versi kecil & mirip style sebelumnya)\r\n");
      out.write("   ----------\r\n");
      out.write("*/\r\n");
      out.write("#loadingSpinner {\r\n");
      out.write("    display: none;\r\n");
      out.write("    position: fixed;\r\n");
      out.write("    top: 22%;\r\n");
      out.write("    left: 50%;\r\n");
      out.write("    transform: translate(-50%, 0);\r\n");
      out.write("    z-index: 9999;\r\n");
      out.write("    padding: 12px 18px;\r\n");
      out.write("    border-radius: 6px;\r\n");
      out.write("    text-align: center;\r\n");
      out.write("}\r\n");
      out.write("\r\n");
      out.write("#loadingSpinner .spinner-content {\r\n");
      out.write("    font-size: 0.9rem;\r\n");
      out.write("    color: #333;\r\n");
      out.write("    text-align: center;\r\n");
      out.write("}\r\n");
      out.write("\r\n");
      out.write("/* Spinner bulat kecil */\r\n");
      out.write(".spinner-mini {\r\n");
      out.write("    border: 3px solid #3b82f6;\r\n");
      out.write("    border-top-color: transparent;\r\n");
      out.write("    border-radius: 50%;\r\n");
      out.write("    width: 22px;\r\n");
      out.write("    height: 22px;\r\n");
      out.write("    margin: 0 auto 6px auto;\r\n");
      out.write("    animation: spin 0.8s linear infinite;\r\n");
      out.write("}\r\n");
      out.write("\r\n");
      out.write("/* Posisi overlay tambahan jika diperlukan */\r\n");
      out.write(".overlay-spinner {\r\n");
      out.write("    position: absolute;\r\n");
      out.write("    top: 40%;\r\n");
      out.write("    left: 45%;\r\n");
      out.write("    z-index: 1060;\r\n");
      out.write("}\r\n");
      out.write("\r\n");
      out.write("@keyframes spin {\r\n");
      out.write("    100% { transform: rotate(360deg); }\r\n");
      out.write("}\r\n");
      out.write("</style>\r\n");
      out.write("\r\n");
      out.write("<!-- ‚úÖ Spinner universal (bisa dipakai rekap & detail) -->\r\n");
      out.write("<div id=\"spinnerOverlay\"\r\n");
      out.write("     class=\"hidden fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 \r\n");
      out.write("            z-[9999] flex-col items-center justify-center bg-white bg-opacity-80 \r\n");
      out.write("            p-4 rounded-lg shadow-lg pointer-events-none\">\r\n");
      out.write("    <div class=\"border-4 border-blue-500 border-t-transparent rounded-full w-8 h-8 animate-spin\"></div>\r\n");
      out.write("    <span class=\"text-xs text-gray-600 mt-2 font-medium\">Loading...</span>\r\n");
      out.write("</div>\r\n");
      out.write("\r\n");
      out.write("<!-- =========================\r\n");
      out.write("     FORM FILTER\r\n");
      out.write("     ========================= -->\r\n");
      out.write("<div class=\"flex justify-center\">\r\n");
      out.write("    <fieldset class=\"border border-gray-300 rounded p-5 mt-4 w-full  mx-auto bg-white shadow text-left\">\r\n");
      out.write("        <legend class=\"text-sm font-bold px-3 text-left\">Download/Print Struk - Bank MIV</legend>\r\n");
      out.write("\r\n");
      out.write("        <form id=\"form-monitoring\" class=\"w-full\">\r\n");
      out.write("            <!-- === ROW INPUT (1 BARIS, 4 KOLOM) === -->\r\n");
      out.write("            <div class=\"grid grid-cols-12 gap-4 mb-4\">\r\n");
      out.write("\r\n");
      out.write("                <!-- Bulan Laporan -->\r\n");
      out.write("                <div class=\"col-span-12 md:col-span-3\">\r\n");
      out.write("                    <label for=\"bln_usulan\" class=\"block text-gray-700 mb-1 font-medium\">Bulan Laporan :</label>\r\n");
      out.write("                    <div class=\"flex border border-gray-300 rounded items-center\">\r\n");
      out.write("                        <input type=\"text\" id=\"bln_usulan\"\r\n");
      out.write("                            class=\"flex-1 px-3 py-2 text-sm uppercase focus:outline-none focus:ring-1 focus:ring-blue-500\"\r\n");
      out.write("                            placeholder=\"Pilih Bulan Laporan\" readonly>\r\n");
      out.write("                        <i id=\"calendarIcon\"\r\n");
      out.write("                        class=\"fa fa-calendar text-gray-500 px-3 cursor-pointer hover:text-blue-600\"></i>\r\n");
      out.write("                    </div>\r\n");
      out.write("                    <input type=\"hidden\" id=\"bln_usulan_value\" name=\"bln_usulan_value\">\r\n");
      out.write("                </div>\r\n");
      out.write("\r\n");
      out.write("                <!-- Bank MIV -->\r\n");
      out.write("                <div class=\"col-span-12 md:col-span-3\">\r\n");
      out.write("                    <label for=\"bank_miv\" class=\"block text-gray-700 mb-1 font-medium\">Bank MIV :</label>\r\n");
      out.write("                    <select id=\"bank_miv\" name=\"bank_miv\"\r\n");
      out.write("                            class=\"w-full border border-gray-300 rounded px-3 py-2 text-sm focus:ring-1 focus:ring-blue-500\">\r\n");
      out.write("                        <option value=\"\">-- Pilih Bank MIV --</option>\r\n");
      out.write("                    </select>\r\n");
      out.write("                </div>\r\n");
      out.write("\r\n");
      out.write("                <!-- Distribusi -->\r\n");
      out.write("                <div class=\"col-span-12 md:col-span-3\">\r\n");
      out.write("                    <label for=\"diswil\" class=\"block text-gray-700 mb-1 font-medium\">Distribusi/Wilayah :</label>\r\n");
      out.write("                    <select id=\"diswil\" name=\"diswil\"\r\n");
      out.write("                            class=\"w-full border border-gray-300 rounded px-3 py-2 text-sm focus:ring-1 focus:ring-blue-500\">\r\n");
      out.write("                        <option value=\"\">-- Pilih Distribusi --</option>\r\n");
      out.write("                    </select>\r\n");
      out.write("                </div>\r\n");
      out.write("\r\n");
      out.write("                <!-- UP3 -->\r\n");
      out.write("                <div class=\"col-span-12 md:col-span-3\">\r\n");
      out.write("                    <label for=\"up3\" class=\"block text-gray-700 mb-1 font-medium\">UP3 :</label>\r\n");
      out.write("                    <select id=\"up3\" name=\"up3\"\r\n");
      out.write("                            class=\"w-full border border-gray-300 rounded px-3 py-2 text-sm focus:ring-1 focus:ring-blue-500\">\r\n");
      out.write("                        <option value=\"\">-- Pilih UP3 --</option>\r\n");
      out.write("                    </select>\r\n");
      out.write("                </div>\r\n");
      out.write("\r\n");
      out.write("            </div>\r\n");
      out.write("\r\n");
      out.write("            <!-- Tombol Tampilkan -->\r\n");
      out.write("            <div class=\"flex justify-center mt-2\">\r\n");
      out.write("                <button id=\"btnTampil\" type=\"button\"\r\n");
      out.write("                        class=\"max-w-[160px] w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold px-3 py-2 rounded shadow flex items-center justify-center gap-2 transition\">\r\n");
      out.write("                    <i class=\"fa fa-search\"></i> <span>Tampilkan</span>\r\n");
      out.write("                </button>\r\n");
      out.write("            </div>\r\n");
      out.write("\r\n");
      out.write("        </form>\r\n");
      out.write("\r\n");
      out.write("    </fieldset>\r\n");
      out.write("</div>\r\n");
      out.write("\r\n");
      out.write("<!-- =========================\r\n");
      out.write("     DAFTAR FILE PDF\r\n");
      out.write("     ========================= -->\r\n");
      out.write("<div class=\"flex justify-center\">\r\n");
      out.write("    <fieldset class=\"border border-gray-300 rounded p-5 mt-4 w-full text-center bg-white shadow\">\r\n");
      out.write("        <h3 class=\"text-xl font-semibold mb-4\">üìÇ Daftar File PDF</h3>\r\n");
      out.write("\r\n");
      out.write("        <!-- loading text -->\r\n");
      out.write("        <div id=\"loading\" class=\"text-blue-600 animate-pulse mb-3\">Memuat daftar file dari FTP...</div>\r\n");
      out.write("\r\n");
      out.write("        <!-- list -->\r\n");
      out.write("        <div class=\"flex justify-center\">\r\n");
      out.write("            <select id=\"thelist\" size=\"10\" class=\"border border-gray-300 rounded w-full md:w-[980px] p-2\" multiple></select>\r\n");
      out.write("        </div>\r\n");
      out.write("\r\n");
      out.write("        <!-- tombol print/download -->\r\n");
      out.write("        <div class=\"flex justify-center mt-4\">\r\n");
      out.write("            <button id=\"btnPrint\" type=\"button\"\r\n");
      out.write("                    class=\"max-w-[160px] w-full bg-green-600 hover:bg-green-700 text-white font-semibold px-4 py-2 rounded shadow flex items-center justify-center gap-2 transition duration-150 ease-in-out\">\r\n");
      out.write("                <i class=\"fa fa-print\"></i> <span>Print PDF</span>\r\n");
      out.write("            </button>\r\n");
      out.write("        </div>\r\n");
      out.write("    </fieldset>\r\n");
      out.write("</div>\r\n");
      out.write("\r\n");
      out.write("<!-- =========================\r\n");
      out.write("     SCRIPT\r\n");
      out.write("     ========================= -->\r\n");
      out.write("<script>\r\n");
      out.write("document.addEventListener(\"DOMContentLoaded\", function () {\r\n");
      out.write("\r\n");
      out.write("    // helper - context path (tidak mengubah alur)\r\n");
      out.write("    function getContextPath() {\r\n");
      out.write("        return '");
      out.print( request.getContextPath() );
      out.write("';\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    const spinner = document.getElementById('spinnerOverlay');\r\n");
      out.write("\r\n");
      out.write("    function showSpinner(){ spinner.style.display='flex'; }\r\n");
      out.write("    function hideSpinner(){ spinner.style.display='none'; }\r\n");
      out.write("\r\n");
      out.write("    // -------------------------\r\n");
      out.write("    // 1) Load FTP files (AJAX)\r\n");
      out.write("    // -------------------------\r\n");
      out.write("    async function loadStrukFiles() {\r\n");
      out.write("        // tampilkan loading\r\n");
      out.write("        const loading = document.getElementById('loading');\r\n");
      out.write("        const list = document.getElementById('thelist');\r\n");
      out.write("\r\n");
      out.write("        // note: menjaga nama variable/ID sesuai request (tidak mengubah flow)\r\n");
      out.write("        // perhatikan: beberapa ID mungkin berbeda di versi lain, ini adalah versi rapih saja\r\n");
      out.write("        showSpinner();\r\n");
      out.write("        try {\r\n");
      out.write("            // ambil parameter dari form\r\n");
      out.write("            const raw = document.getElementById(\"bln_usulan\").value;\r\n");
      out.write("            const thblalp = convertBulanTahunToYYYYMM(raw);\r\n");
      out.write("            const bank_miv = document.getElementById(\"bank_miv\").value;\r\n");
      out.write("            const diswil = document.getElementById(\"diswil\").value;\r\n");
      out.write("            const up3 = document.getElementById(\"up3\").value;\r\n");
      out.write("\r\n");
      out.write("            console.log(\"Param - thblalp:\", thblalp, \"bank_miv:\", bank_miv, \"diswil:\", diswil, \"up3:\", up3);\r\n");
      out.write("\r\n");
      out.write("            // tampilkan loading\r\n");
      out.write("            loading.style.display = 'block';\r\n");
      out.write("            loading.textContent = \"Memuat daftar file dari FTP...\";\r\n");
      out.write("            list.innerHTML = '';\r\n");
      out.write("\r\n");
      out.write("            // bangun URL (sesuai flow Anda)\r\n");
      out.write("            const url = getContextPath()\r\n");
      out.write("                + \"/mon2strukbank?act=list\"\r\n");
      out.write("                + \"&thbl=\" + encodeURIComponent(thblalp)\r\n");
      out.write("                + \"&bankmiv=\" + encodeURIComponent(bank_miv)\r\n");
      out.write("                + \"&upi=\" + encodeURIComponent(diswil)\r\n");
      out.write("                + \"&up3=\" + encodeURIComponent(up3);\r\n");
      out.write("\r\n");
      out.write("            // panggil API\r\n");
      out.write("            const res = await fetch(url);\r\n");
      out.write("            if (!res.ok) throw new Error(\"Gagal memuat data dari server\");\r\n");
      out.write("\r\n");
      out.write("            // response diharapkan { files: [...] } sesuai controller Anda\r\n");
      out.write("            const json = await res.json();\r\n");
      out.write("            const files = json.files || [];\r\n");
      out.write("\r\n");
      out.write("            loading.style.display = 'none';\r\n");
      out.write("\r\n");
      out.write("            if (!files || files.length === 0) {\r\n");
      out.write("                const opt = document.createElement('option');\r\n");
      out.write("                opt.textContent = \"Tidak ada file di folder FTP.\";\r\n");
      out.write("                list.appendChild(opt);\r\n");
      out.write("                return;\r\n");
      out.write("            }\r\n");
      out.write("\r\n");
      out.write("            files.forEach(filePath => {\r\n");
      out.write("                const opt = document.createElement('option');\r\n");
      out.write("                opt.value = filePath;\r\n");
      out.write("                opt.textContent = filePath.split('/').pop();\r\n");
      out.write("                list.appendChild(opt);\r\n");
      out.write("            });\r\n");
      out.write("\r\n");
      out.write("        } catch (err) {\r\n");
      out.write("            loading.innerHTML = '<span class=\"text-red-600\">Terjadi kesalahan: ' + err.message + '</span>';\r\n");
      out.write("            console.error(\"ERROR loadStrukFiles:\", err);\r\n");
      out.write("            hideSpinner();\r\n");
      out.write("        }finally{\r\n");
      out.write("            hideSpinner();\r\n");
      out.write("        }\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    // -------------------------\r\n");
      out.write("    // 2) Flatpickr (bulan)\r\n");
      out.write("    // -------------------------\r\n");
      out.write("    if (typeof flatpickr !== \"undefined\") {\r\n");
      out.write("        const blnUsulan = document.getElementById('bln_usulan');\r\n");
      out.write("        const blnUsulanValue = document.getElementById('bln_usulan_value');\r\n");
      out.write("        const calendarIcon = document.getElementById('calendarIcon');\r\n");
      out.write("\r\n");
      out.write("        const fp = flatpickr(blnUsulan, {\r\n");
      out.write("            locale: \"id\",\r\n");
      out.write("            plugins: [new monthSelectPlugin({\r\n");
      out.write("                shorthand: false,\r\n");
      out.write("                dateFormat: \"F Y\",\r\n");
      out.write("                altFormat: \"Y-m\"\r\n");
      out.write("            })],\r\n");
      out.write("            defaultDate: new Date(),\r\n");
      out.write("            onChange: function (selectedDates) {\r\n");
      out.write("                const date = selectedDates[0];\r\n");
      out.write("                if (date) {\r\n");
      out.write("                    const yyyy = date.getFullYear();\r\n");
      out.write("                    const mm = String(date.getMonth() + 1).padStart(2, '0');\r\n");
      out.write("                    blnUsulanValue.value = yyyy + mm;\r\n");
      out.write("                }\r\n");
      out.write("            },\r\n");
      out.write("            onReady: function (selectedDates) {\r\n");
      out.write("                const date = selectedDates[0] || new Date();\r\n");
      out.write("                const yyyy = date.getFullYear();\r\n");
      out.write("                const mm = String(date.getMonth() + 1).padStart(2, '0');\r\n");
      out.write("                blnUsulanValue.value = yyyy + mm;\r\n");
      out.write("                blnUsulan.value = date.toLocaleString('id-ID', { month: 'long' }) + ' ' + yyyy;\r\n");
      out.write("            }\r\n");
      out.write("        });\r\n");
      out.write("\r\n");
      out.write("        calendarIcon.addEventListener('click', function () {\r\n");
      out.write("            fp.open();\r\n");
      out.write("        });\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    // -------------------------\r\n");
      out.write("    // 3) convert bulan nama -> YYYYMM\r\n");
      out.write("    // -------------------------\r\n");
      out.write("    function convertBulanTahunToYYYYMM(input) {\r\n");
      out.write("        if (!input) return '';\r\n");
      out.write("        const bulanMap = {\r\n");
      out.write("            \"Januari\": \"01\", \"Februari\": \"02\", \"Maret\": \"03\",\r\n");
      out.write("            \"April\": \"04\", \"Mei\": \"05\", \"Juni\": \"06\",\r\n");
      out.write("            \"Juli\": \"07\", \"Agustus\": \"08\", \"September\": \"09\",\r\n");
      out.write("            \"Oktober\": \"10\", \"November\": \"11\", \"Desember\": \"12\"\r\n");
      out.write("        };\r\n");
      out.write("\r\n");
      out.write("        const parts = input.split(\" \");   // \"November 2025\" ‚Üí [\"November\", \"2025\"]\r\n");
      out.write("        const bulan = bulanMap[parts[0]] || '';\r\n");
      out.write("        const tahun = parts[1] || '';\r\n");
      out.write("\r\n");
      out.write("        return tahun + bulan; // \"2025\" + \"11\" ‚Üí \"202511\"\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    // -------------------------\r\n");
      out.write("    // 4) Load Bank MIV\r\n");
      out.write("    // -------------------------\r\n");
      out.write("    async function loadBankMIV() {\r\n");
      out.write("        console.log(\"üîÑ Memuat daftar bank MIV...\");\r\n");
      out.write("        const params = new URLSearchParams();\r\n");
      out.write("        params.append('act', 'getNamaBank');\r\n");
      out.write("        params.append('kdbank', '');\r\n");
      out.write("\r\n");
      out.write("        try {\r\n");
      out.write("            const res = await fetch(getContextPath() + '/mst-global', {\r\n");
      out.write("                method: 'POST',\r\n");
      out.write("                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },\r\n");
      out.write("                body: params.toString()\r\n");
      out.write("            });\r\n");
      out.write("            if (!res.ok) throw new Error(\"HTTP Error \" + res.status);\r\n");
      out.write("            const json = await res.json();\r\n");
      out.write("\r\n");
      out.write("            const select = document.getElementById('bank_miv');\r\n");
      out.write("            select.innerHTML = '<option value=\"\">-- Pilih Bank MIV --</option>';\r\n");
      out.write("\r\n");
      out.write("            if (json.status === 'success' && Array.isArray(json.data)) {\r\n");
      out.write("                json.data.forEach(bank => {\r\n");
      out.write("                    const opt = document.createElement('option');\r\n");
      out.write("                    opt.value = bank.KODE_ERP;\r\n");
      out.write("                    opt.textContent = bank.NAMA_BANK;\r\n");
      out.write("                    select.appendChild(opt);\r\n");
      out.write("                });\r\n");
      out.write("                console.log(\"‚úÖ Bank MIV berhasil dimuat:\", json.data.length, \"data\");\r\n");
      out.write("            } else {\r\n");
      out.write("                const opt = document.createElement('option');\r\n");
      out.write("                opt.textContent = \"Tidak ada data bank\";\r\n");
      out.write("                select.appendChild(opt);\r\n");
      out.write("            }\r\n");
      out.write("        } catch (err) {\r\n");
      out.write("            console.error(\"‚ùå Error JS:\", err.message);\r\n");
      out.write("        }\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    // -------------------------\r\n");
      out.write("    // 5) Load DIS/WIL\r\n");
      out.write("    // -------------------------\r\n");
      out.write("    async function loadDisWilMIV() {\r\n");
      out.write("        console.log(\"üîÑ Memuat daftar DIS/WIL...\");\r\n");
      out.write("\r\n");
      out.write("        const params = new URLSearchParams();\r\n");
      out.write("        params.append('act', 'getNamaUnitUPI');\r\n");
      out.write("        params.append('kd_dist', 'ALL');\r\n");
      out.write("\r\n");
      out.write("        try {\r\n");
      out.write("            const res = await fetch(getContextPath() + '/mst-global', {\r\n");
      out.write("                method: 'POST',\r\n");
      out.write("                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },\r\n");
      out.write("                body: params.toString()\r\n");
      out.write("            });\r\n");
      out.write("            if (!res.ok) throw new Error(\"HTTP Error \" + res.status);\r\n");
      out.write("            const json = await res.json();\r\n");
      out.write("\r\n");
      out.write("            const select = document.getElementById('diswil');\r\n");
      out.write("            select.innerHTML = '<option value=\"\">-- Pilih DIS/WIL MIV --</option>';\r\n");
      out.write("\r\n");
      out.write("            if (json.status === 'success' && Array.isArray(json.data)) {\r\n");
      out.write("                json.data.forEach(diswil => {\r\n");
      out.write("                    const opt = document.createElement('option');\r\n");
      out.write("                    opt.value = diswil.KD_DIST;\r\n");
      out.write("                    opt.textContent = diswil.NAMA_DIST;\r\n");
      out.write("                    select.appendChild(opt);\r\n");
      out.write("                });\r\n");
      out.write("                console.log(\"‚úÖ DISWIL MIV berhasil dimuat:\", json.data.length, \"data\");\r\n");
      out.write("            } else {\r\n");
      out.write("                const opt = document.createElement('option');\r\n");
      out.write("                opt.textContent = \"Tidak ada data DISWIL\";\r\n");
      out.write("                select.appendChild(opt);\r\n");
      out.write("            }\r\n");
      out.write("        } catch (err) {\r\n");
      out.write("            console.error(\"‚ùå Error JS:\", err.message);\r\n");
      out.write("        }\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    // -------------------------\r\n");
      out.write("    // 6) Load UP3 berdasarkan DIS/WIL\r\n");
      out.write("    // -------------------------\r\n");
      out.write("    async function loadUP3MIV(kd_dist) {\r\n");
      out.write("        console.log(\"üîÑ Memuat daftar UP3 untuk kd_dist:\", kd_dist);\r\n");
      out.write("\r\n");
      out.write("        const params = new URLSearchParams();\r\n");
      out.write("        params.append('act', 'getNamaArea');\r\n");
      out.write("        params.append('kd_dist', kd_dist);\r\n");
      out.write("\r\n");
      out.write("        try {\r\n");
      out.write("            const res = await fetch(getContextPath() + '/mst-global', {\r\n");
      out.write("                method: 'POST',\r\n");
      out.write("                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },\r\n");
      out.write("                body: params.toString()\r\n");
      out.write("            });\r\n");
      out.write("            if (!res.ok) throw new Error(\"HTTP Error \" + res.status);\r\n");
      out.write("\r\n");
      out.write("            const text = await res.text();\r\n");
      out.write("            if (!text) return;\r\n");
      out.write("            const json = JSON.parse(text);\r\n");
      out.write("\r\n");
      out.write("            const select = document.getElementById('up3');\r\n");
      out.write("            select.innerHTML = '<option value=\"\">-- Pilih UP3 MIV --</option>';\r\n");
      out.write("\r\n");
      out.write("            if (json.status === 'success' && Array.isArray(json.data)) {\r\n");
      out.write("                json.data.forEach(up3 => {\r\n");
      out.write("                    const opt = document.createElement('option');\r\n");
      out.write("                    opt.value = up3.UNITAP;\r\n");
      out.write("                    opt.textContent = up3.NAMA_AREA;\r\n");
      out.write("                    select.appendChild(opt);\r\n");
      out.write("                });\r\n");
      out.write("                console.log(\"‚úÖ UP3 MIV berhasil dimuat:\", json.data.length, \"data\");\r\n");
      out.write("            } else {\r\n");
      out.write("                const opt = document.createElement('option');\r\n");
      out.write("                opt.textContent = \"Tidak ada data UP3\";\r\n");
      out.write("                select.appendChild(opt);\r\n");
      out.write("            }\r\n");
      out.write("        } catch (err) {\r\n");
      out.write("            console.error(\"‚ùå Error JS:\", err.message);\r\n");
      out.write("        }\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    // -------------------------\r\n");
      out.write("    // 7) Init: load bank & diswil\r\n");
      out.write("    // -------------------------\r\n");
      out.write("    loadBankMIV();\r\n");
      out.write("    loadDisWilMIV();\r\n");
      out.write("\r\n");
      out.write("    // -------------------------\r\n");
      out.write("    // 8) Event listeners\r\n");
      out.write("    // -------------------------\r\n");
      out.write("    document.getElementById('diswil').addEventListener('change', function () {\r\n");
      out.write("        const kd_dist = this.value;\r\n");
      out.write("        console.log(\"Distribusi terpilih:\", kd_dist);\r\n");
      out.write("        if (kd_dist) {\r\n");
      out.write("            loadUP3MIV(kd_dist);\r\n");
      out.write("        } else {\r\n");
      out.write("            document.getElementById('up3').innerHTML = '<option value=\"\">-- Pilih UP3 MIV --</option>';\r\n");
      out.write("        }\r\n");
      out.write("    });\r\n");
      out.write("\r\n");
      out.write("    // Tombol Tampilkan\r\n");
      out.write("    document.getElementById('btnTampil').addEventListener('click', function () {\r\n");
      out.write("\r\n");
      out.write("        const bank_miv = document.getElementById(\"bank_miv\").value;\r\n");
      out.write("        if (!bank_miv || bank_miv.trim() === \"\") {\r\n");
      out.write("            alert(\"‚ö† Silakan pilih BANK MIV terlebih dahulu!\");\r\n");
      out.write("            return;\r\n");
      out.write("        }\r\n");
      out.write("\r\n");
      out.write("        const diswil = document.getElementById(\"diswil\").value;\r\n");
      out.write("        if (!diswil || diswil.trim() === \"\") {\r\n");
      out.write("            alert(\"‚ö† Silakan pilih DISTRIBUSI/WILAYAH terlebih dahulu!\");\r\n");
      out.write("            return;\r\n");
      out.write("        }\r\n");
      out.write("\r\n");
      out.write("        const up3 = document.getElementById(\"up3\").value;\r\n");
      out.write("        if (!up3 || up3.trim() === \"\") {\r\n");
      out.write("            alert(\"‚ö† Silakan pilih PILIH UP3 dahulu!\");\r\n");
      out.write("            return;\r\n");
      out.write("        }\r\n");
      out.write("\r\n");
      out.write("        // lanjut proses\r\n");
      out.write("        loadStrukFiles();\r\n");
      out.write("    });\r\n");
      out.write("\r\n");
      out.write("    // Tombol Print (download multiple)\r\n");
      out.write("    document.getElementById(\"btnPrint\").addEventListener(\"click\", function () {\r\n");
      out.write("        const list = document.getElementById(\"thelist\");\r\n");
      out.write("        const selected = Array.from(list.selectedOptions).map(opt => opt.value);\r\n");
      out.write("\r\n");
      out.write("        if (selected.length === 0) {\r\n");
      out.write("            alert(\"‚ö† Silakan pilih minimal 1 file PDF!\");\r\n");
      out.write("            return;\r\n");
      out.write("        }\r\n");
      out.write("\r\n");
      out.write("        selected.forEach((filePath, index) => {\r\n");
      out.write("            console.log(\"DOWNLOAD:\", filePath);\r\n");
      out.write("\r\n");
      out.write("            setTimeout(function () {\r\n");
      out.write("                window.open(getContextPath() + \"/mon2strukbank?act=download&file=\" + encodeURIComponent(filePath), \"_blank\");\r\n");
      out.write("            }, index * 500);\r\n");
      out.write("        });\r\n");
      out.write("\r\n");
      out.write("    });\r\n");
      out.write("\r\n");
      out.write("}); // end DOMContentLoaded\r\n");
      out.write("</script>\r\n");
    } catch (java.lang.Throwable t) {
      if (!(t instanceof javax.servlet.jsp.SkipPageException)){
        out = _jspx_out;
        if (out != null && out.getBufferSize() != 0)
          try { out.clearBuffer(); } catch (java.io.IOException e) {}
        if (_jspx_page_context != null) _jspx_page_context.handlePageException(t);
        else throw new ServletException(t);
      }
    } finally {
      _jspxFactory.releasePageContext(_jspx_page_context);
    }
  }
}
